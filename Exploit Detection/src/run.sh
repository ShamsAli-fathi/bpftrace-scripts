#!/bin/bash

TRACE_MARKER="/sys/kernel/debug/tracing/trace_marker"

# Check if trace_marker is writable
if [ ! -w "$TRACE_MARKER" ]; then
    echo "ERROR: $TRACE_MARKER not writable. Are you root? Is tracing enabled?"
    exit 1
fi

# Run bpftrace and pipe each line to trace_marker
sudo ./bpftrace main.bt | while IFS= read -r line; do
    echo "$line" > "$TRACE_MARKER"
done
